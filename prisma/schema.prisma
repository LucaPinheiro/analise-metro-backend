generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Project {
  id          Int        @id @default(autoincrement())
  name        String
  description String?
  bimPath     String     @unique @map("bim_path")
  createdAt   DateTime   @default(now()) @map("created_at")
  records     Record[]
  analyses    Analysis[]

  @@map("project")
}

model Record {
  id                 Int        @id @default(autoincrement())
  name               String
  uploadedFilesPaths Json?      @map("uploaded_files_paths")
  recordPath         String?    @map("record_path")
  createdAt          DateTime   @default(now()) @map("created_at")
  projectId          Int        @map("project_id")
  project            Project    @relation(fields: [projectId], references: [id])

  analyses           Analysis[]

  @@map("record")
}

model Analysis {
  id                Int        @id @default(autoincrement())
  status            String     @default("pending")
  progress          Int        @default(0)
  logs              String[]
  error             String?
  outputPaths       Json?      @map("output_paths")
  createdAt         DateTime   @default(now()) @map("created_at")
  startedAt         DateTime?  @map("started_at")
  updatedAt         DateTime   @updatedAt @map("updated_at")
  completedAt       DateTime?  @map("completed_at")
  resultPath        String?    @map("result_path")
  summaryJsonPath   String?    @map("summary_json_path")
  meanDistance      Float?     @map("mean_distance")
  stdDeviation      Float?     @map("std_deviation")
  projectId         Int        @map("project_id")
  project           Project    @relation(fields: [projectId], references: [id])
  recordId          Int        @map("record_id")
  record            Record     @relation(fields: [recordId], references: [id])

  @@map("analysis")
}